!function($,undefined){"use strict";$us.WPopup=function(container){var self=this;this.$container=$(container);this.$content=$('.w-popup-box-content',this.$container);this._events={show:this.show.bind(this),afterShow:this.afterShow.bind(this),hide:this.hide.bind(this),hideOnLinkClick:this.hideOnLinkClick.bind(this),preventHide:function(e){e.stopPropagation()},afterHide:this.afterHide.bind(this),keyup:function(e){if(e.key=="Escape"){this.hide()}}.bind(this),scroll:function(){$us.$document.trigger('scroll')},touchmove:function(e){this.savePopupSizes();if((this.popupSizes.wrapHeight>this.popupSizes.contentHeight)||!$(e.target).closest('.w-popup-box').length){e.preventDefault()}}.bind(this),};this.transitionEndEvent=(navigator.userAgent.search(/webkit/i)>0)?'webkitTransitionEnd':'transitionend';this.isFixed=!jQuery.isMobile;self.$trigger=$('.w-popup-trigger',self.$container);self.triggerType=self.$trigger.usMod('type');self.triggerOptions=$ush.toPlainObject(self.$trigger.data('options'));if(self.triggerType=='load'){var _timeoutHandle;if(self.$container.css('display')!='none'){var delay=$ush.parseInt(self.triggerOptions.delay);_timeoutHandle=$ush.timeout(self.show.bind(self),delay*1000)}
self.$container.on('usb.refreshedEntireNode',function(){if(_timeoutHandle){$ush.clearTimeout(_timeoutHandle)}
self.$overlay.remove();self.$wrap.remove()})}else if(this.triggerType=='selector'){var selector=this.$trigger.data('selector');if(selector){$us.$body.on('click',selector,this._events.show)}}else{this.$trigger.on('click',this._events.show)}
this.$wrap=this.$container.find('.w-popup-wrap').usMod('pos',this.isFixed?'fixed':'absolute').on('click',this._events.hide);this.$box=this.$container.find('.w-popup-box');this.$overlay=this.$container.find('.w-popup-overlay').usMod('pos',this.isFixed?'fixed':'absolute').on('click',this._events.hide);this.$container.find('.w-popup-closer').on('click',this._events.hide);this.$box.on('click',this._events.preventHide);this.$wrap.find('a').on('click',this._events.hideOnLinkClick.bind(this));this.$media=$('video,audio',this.$box);this.$wVideos=$('.w-video',this.$box);this.timer=null;this.popupSizes={boxHeight:0,wrapHeight:0,contentHeight:0,initialWindowHeight:window.innerHeight,openedWindowHeight:0,}};$us.WPopup.prototype={_hasScrollbar:function(){return document.documentElement.scrollHeight>document.documentElement.clientHeight},_getScrollbarSize:function(){if($us.scrollbarSize===undefined){var scrollDiv=document.createElement('div');scrollDiv.style.cssText='width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;';document.body.appendChild(scrollDiv);$us.scrollbarSize=scrollDiv.offsetWidth-scrollDiv.clientWidth;document.body.removeChild(scrollDiv)}
return $us.scrollbarSize},show:function(e){var self=this;if(e!==undefined){e.preventDefault()}
if(self.triggerType=='load'&&!$us.usbPreview()){var uniqueId=$ush.toString(self.triggerOptions.uniqueId),cookieName='us_popup_'+uniqueId;if(uniqueId){if($ush.getCookie(cookieName)!==null){return}
var daysUntilNextShow=$ush.parseInt(self.triggerOptions.daysUntilNextShow);$ush.setCookie(cookieName,'shown',daysUntilNextShow||365)}}
this.saveWindowSizes();clearTimeout(this.timer);this.$overlay.appendTo($us.$body).show();this.$wrap.appendTo($us.$body).css('display','flex');if(this.isFixed){$us.$html.addClass('usoverlay_fixed');this.windowHasScrollbar=this._hasScrollbar();if(this.windowHasScrollbar&&this._getScrollbarSize()){$us.$html.css('margin-right',this._getScrollbarSize())}}else{this.$wrap.css('top',$us.$window.scrollTop());$us.$body.addClass('popup-active');this.savePopupSizes();if((this.popupSizes.initialWindowHeight===this.popupSizes.openedWindowHeight)&&(this.popupSizes.boxHeight>=this.popupSizes.wrapHeight)){this.$wrap.addClass('popup-ios-height')}
this.$wrap.on('touchmove',this._events.touchmove);$us.$document.on('touchmove',this._events.touchmove)}
$us.$body.on('keyup',this._events.keyup);this.$wrap.on('scroll',this._events.scroll);this.timer=setTimeout(this._events.afterShow,25)},afterShow:function(){clearTimeout(this.timer);this.$overlay.addClass('active');this.$box.addClass('active');if(window.$us!==undefined&&$us.$canvas!==undefined){$us.$canvas.trigger('contentChange',{elm:this.$container})}
if(this.$wVideos.length){this.$wVideos.each(function(_,wVideo){var $wVideoSource=$(wVideo).find('[data-src]'),$videoTag=$wVideoSource.parent('video'),src=$wVideoSource.data('src');if(!src){return}
$wVideoSource.attr('src',src);if($videoTag.length){$videoTag[0].load()}})}
$us.$body.addClass('has_uspopup');$us.$window.trigger('resize').trigger('us.wpopup.afterShow',this)},hide:function(){clearTimeout(this.timer);$us.$body.off('keyup',this._events.keyup);this.$box.on(this.transitionEndEvent,this._events.afterHide);this.$overlay.removeClass('active');this.$box.removeClass('active');this.$wrap.off('scroll',this._events.scroll);$us.$document.off('touchmove',this._events.touchmove);this.timer=setTimeout(this._events.afterHide,1000)},hideOnLinkClick:function(event){var $item=$(event.currentTarget),place=$item.attr('href');if((place.indexOf('#')===-1)||(place!=='#'&&place.indexOf('#')===0&&this.$wrap.find(place).length)){return}
this.hide()},afterHide:function(){clearTimeout(this.timer);this.$box.off(this.transitionEndEvent,this._events.afterHide);this.$overlay.appendTo(this.$container).hide();this.$wrap.appendTo(this.$container).hide();if(this.isFixed){$us.$html.removeClass('usoverlay_fixed');if(this.windowHasScrollbar){$us.$html.css('margin-right','')}
$us.$window.trigger('resize',!0).trigger('us.wpopup.afterHide',this)}else{$us.$body.removeClass('popup-active');this.$wrap.removeClass('popup-ios-height')}
if(this.$media.length){this.$media.trigger('pause')}
if(this.$wVideos.length){this.$wVideos.each(function(_,wVideo){var $wVideoSource=$(wVideo).find('[src]');if(!$wVideoSource.data('src')){$wVideoSource.attr('data-src',$wVideoSource.attr('src'))}
$wVideoSource.attr('src','')})}
$us.$body.removeClass('has_uspopup')},savePopupSizes:function(){this.popupSizes.boxHeight=this.$box.height();this.popupSizes.wrapHeight=this.$wrap.height();this.popupSizes.contentHeight=this.$content.outerHeight(!0)},saveWindowSizes:function(){this.popupSizes.openedWindowHeight=window.innerHeight}};$.fn.wPopup=function(options){return this.each(function(){$(this).data('wPopup',new $us.WPopup(this,options))})};$(function(){$('.w-popup').wPopup()})}(jQuery)