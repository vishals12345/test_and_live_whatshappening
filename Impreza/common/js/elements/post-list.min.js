(function($){"use strict";const DELETE_FILTER=null;const PAGINATION_PATTERN=/\/page\/?([0-9]{1,})\/?$/;let _originalURL;$us.WPostList=function(container){const self=this;self.data={paged:1,max_num_pages:1,pagination:'none',ajaxUrl:$us.ajaxUrl,ajaxData:{us_ajax_list_pagination:1,},};self.xhr;self.$container=$(container);self.$list=$('.w-grid-list',container);self.$loadmore=$('.g-loadmore',container);self.$pagination=$('nav.pagination',container);self.$none=self.$container.next('.w-grid-none');const $elmSettings=$('.w-grid-list-json:first',container);if($elmSettings.is('[onclick]')){$.extend(self.data,$elmSettings[0].onclick()||{})}
$elmSettings.remove();self.paginationType=$ush.toString(self.data.pagination);self._events={addNextPage:self._addNextPage.bind(self),closePostInPopup:self.closePostInPopup.bind(self),loadPostInPopup:self._loadPostInPopup.bind(self),navigationInPopup:self._navigationInPopup.bind(self),openPostInPopup:self._openPostInPopup.bind(self),usListOrder:self._usListOrder.bind(self),usListSearch:self._usListSearch.bind(self),usListFilter:self._usListFilter.bind(self),};if(self.paginationType==='load_on_btn'){self.$loadmore.on('mousedown','button',self._events.addNextPage)}else if(self.paginationType==='load_on_scroll'){$us.waypoints.add(self.$loadmore,'-70%',self._events.addNextPage)}
self.$container.add(self.$none).on('usListSearch',self._events.usListSearch).on('usListOrder',self._events.usListOrder).on('usListFilter',self._events.usListFilter);if(self.$container.hasClass('open_items_in_popup')){self.$popup=$('.l-popup',container);self.$popupBox=$('.l-popup-box',self.$popup);self.$popupPreloader=$('.g-preloader',self.$popup);self.$popupFrame=$('.l-popup-box-content-frame',self.$popup);self.$popupToPrev=$('.l-popup-arrow.to_prev',self.$popup);self.$popupToNext=$('.l-popup-arrow.to_next',self.$popup);$us.$body.append(self.$popup);self.$list.on('click','.w-grid-item:not(.custom-link) .w-grid-item-anchor',self._events.openPostInPopup);self.$popupFrame.on('load',self._events.loadPostInPopup);self.$popup.on('click','.l-popup-arrow',self._events.navigationInPopup).on('click','.l-popup-closer, .l-popup-box',self._events.closePostInPopup)}};const prototype=$us.WPostList.prototype;$.extend(prototype,{_usListSearch:function(e,name,value){this.applyFilter(name,value)},_usListOrder:function(e,name,value){this.applyFilter(name,value)},_usListFilter:function(e,values){const self=this;$.each(values,self.applyFilter.bind(self))},_addNextPage:function(){const self=this;if($ush.isUndefined(self.xhr)&&!self.$none.is(':visible')){self.addItems()}},applyFilter:function(name,value){const self=this;if($ush.toString(value)=='{}'){value=DELETE_FILTER}
const pathname=location.pathname;if(PAGINATION_PATTERN.test(pathname)){history.pushState({},'',location.href.replace(pathname,pathname.replace(PAGINATION_PATTERN,'')+'/'))}
self.data.paged=0;if(self.$container.hasClass('for_current_wp_query')){self.data.ajaxUrl=$ush.urlManager(self.data.ajaxUrl).set(name,value).toString()}else if(value===DELETE_FILTER){delete self.data.ajaxData[name]}else{self.data.ajaxData[name]=value}
self.$list.html('');$('.w-grid-none',self.$container).remove();if(!$ush.isUndefined(self.xhr)){self.xhr.abort()}
self.addItems(!0);if(!$ush.isNodeInViewport(self.$container[0])){$us.$htmlBody.stop(!0,!1).delay(3).animate({scrollTop:$ush.parseInt(self.$container.offset().top)-$us.header.getInitHeight()},500)}},addItems:$ush.debounce(function(filtersChanged){const self=this;self.data.paged+=1;if(!filtersChanged&&self.data.paged>self.data.max_num_pages){return}
self.$container.removeClass('hidden');self.$loadmore.removeClass('hidden').addClass('loading');self.$pagination.addClass('hidden');self.$none.addClass('hidden');let ajaxUrl=$ush.toString(self.data.ajaxUrl),ajaxData=$ush.clone(self.data.ajaxData),numPage=$ush.rawurlencode('{num_page}');if(ajaxUrl.includes(numPage)){ajaxUrl=ajaxUrl.replace(numPage,self.data.paged)}else if(ajaxData.template_vars){ajaxData.template_vars=JSON.stringify(ajaxData.template_vars);ajaxData.paged=self.data.paged}
self.xhr=$.ajax({type:'post',url:ajaxUrl,dataType:'html',data:ajaxData,success:function(html){let $items=$('.w-grid-list:first > *',html);if(!$items.length){if(!self.$none.length){self.$none=$('.w-grid-none:first',html);if(!self.$none.length){self.$none=$(html).filter('.w-grid-none:first')}
self.$container.after(self.$none)}
self.$loadmore.addClass('hidden');self.$pagination.addClass('hidden');self.$none.removeClass('hidden');return}
if(self.$container.hasClass('type_masonry')){self.$list.isotope('insert',$items).isotope('reloadItems')}else{self.$list.append($items)}
if(window.USAnimate&&self.$container.hasClass('with_css_animation')){new USAnimate(self.$list);$us.$window.trigger('scroll.waypoints')}
$ush.timeout(()=>{$us.$document.trigger('usPostList.itemsLoaded',[$items])},1);let $listJson=$('.w-grid-list-json:first',html);if($listJson.is('[onclick]')){$.extend(!0,self.data,$listJson[0].onclick()||{})}
if(self.paginationType=='numbered'){const $pagination=$('nav.pagination',html);if($pagination.length&&!self.$pagination.length){self.$list.after($pagination.prop('outerHTML'));self.$pagination=self.$list.next('nav.pagination')}
if(self.$pagination.length&&$pagination.length){self.$pagination.html($pagination.html()).removeClass('hidden')}else{self.$pagination.addClass('hidden')}}
if(self.data.paged>=self.data.max_num_pages){self.$loadmore.addClass('hidden');self.$none.addClass('hidden')}else{self.$loadmore.removeClass('hidden')}
if(self.paginationType=='load_on_scroll'){$us.waypoints.add(self.$loadmore,'-70%',self._events.addNextPage)}
$us.$canvas.trigger('contentChange')},complete:function(){self.$loadmore.removeClass('loading');delete self.xhr}})},1),});$.extend(prototype,{_openPostInPopup:function(e){const self=this;if($us.$window.width()<=$us.canvasOptions.disableEffectsWidth){return}
e.stopPropagation();e.preventDefault();_originalURL=location.href;self.setPostInPopup($(e.target).closest('.w-grid-item').index());$us.$html.addClass('usoverlay_fixed');self.$popup.addClass('active');$ush.timeout(()=>{self.$popupBox.addClass('show')},25)},_loadPostInPopup:function(){const self=this;function checkEscape(e){if($ush.toLowerCase(e.key)==='escape'&&self.$popup.hasClass('active')){self.closePostInPopup()}}
self.$container.on('keyup',checkEscape);$('body',self.$popupFrame.contents()).one('keyup.usCloseLightbox',checkEscape)},_navigationInPopup:function(e){this.setPostInPopup($(e.target).data('index'))},setPostInPopup:function(index){const self=this;let $node=$('> *:eq('+$ush.parseInt(index)+')',self.$list),url=$ush.toString($('[href]:first',$node).attr('href'));if(!url){console.error('No url to loaded post');return}
let $prev=$node.prev(':not(.custom-link)'),$next=$node.next(':not(.custom-link)');self.$popupToPrev.data('index',$prev.index()).attr('title',$('.post_title',$prev).text()).toggleClass('hidden',!$prev.length);self.$popupToNext.data('index',$next.index()).attr('title',$('.post_title',$next).text()).toggleClass('hidden',!$next.length);self.$popupPreloader.show();self.$popupFrame.attr('src',url+(url.indexOf('?')>-1?'&':'?')+'us_iframe=1');history.replaceState(null,null,url)},closePostInPopup:function(){const self=this;self.$popupBox.removeClass('show').one('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd',function(){self.$popup.removeClass('active');self.$popupFrame.attr('src','about:blank');self.$popupToPrev.addClass('hidden');self.$popupToNext.addClass('hidden');self.$popupPreloader.show();$us.$html.removeClass('usoverlay_fixed')});if(_originalURL){history.replaceState(null,null,_originalURL)}}});$.fn.wPostList=function(){return this.each(function(){$(this).data('WPostList',new $us.WPostList(this))})};$(()=>{$('.w-grid.us_post_list, .w-grid.us_product_list').wPostList()})})(jQuery)