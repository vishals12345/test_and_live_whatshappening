!function($,undefined){"use strict";var _document=document,_window=window,_null=null;_window.$us=_window.$us||{};const _REGEXP_EXTRACT_COORDINATES_=/^(-?[\d\.]+),(-?[\d\.]+)$/;$us.wLmaps=function(container,options){var self=this;self.$container=$(container);if(self.$container.data('_inited')){return}
self.$container.data('_inited',1);self._mapInstance=_null;self.cookieName=self.$container.data('cookie-name');self.options=options||{};self._events={confirmInit:self._confirmInit.bind(self),redraw:self._redraw.bind(self)};if(self.cookieName){self.$container.on('click','.action_confirm_load',self._events.confirmInit);return}
self._init()};$.extend($us.wLmaps.prototype,{_confirmInit:function(){var self=this;if($('input[name^='+self.cookieName+']:checked',self.$container).length){$ush.setCookie(self.cookieName,1,365)}
self.$container.html($ush.base64Decode($('script[type="text/template"]',self.$container).text())).removeAttr('data-cookie-name');self._init()},_init:function(){var self=this;var $mapJson=$('.w-map-json',self.$container);if($mapJson.is('[onclick]')){$.extend(self.options,$mapJson[0].onclick()||{});$mapJson.remove()}
$us.$canvas.on('contentChange',self._events.redraw);self._beforeRender()},_beforeRender:function(){var self=this,address=(''+self.options.address),matches=$ush.removeSpaces(address).match(_REGEXP_EXTRACT_COORDINATES_);if(matches){self.center=[matches[1],matches[2]];self._render()}else{self._geocoder(address)}},_render:function(){var self=this,mapId=self.$container.attr('id'),lmapsOptions={center:self.center,zoom:self.options.zoom};if(self.options.hideControls){lmapsOptions.zoomControl=!1}
if(self.options.disableZoom){lmapsOptions.scrollWheelZoom=!1}
self._mapInstance=L.map(mapId,lmapsOptions);L.tileLayer(self.options.style,{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(self._mapInstance);self._renderMarkers();if($us.usbPreview()||self.options.disableDragging&&!$us.$html.hasClass('no-touch')){self._mapInstance.dragging.disable()}},_geocoder:function(text,markerOptions,popup){var self=this,osmUrl='https://nominatim.openstreetmap.org/search?format=json&limit=1&q='+encodeURI(text);$.getJSON(osmUrl,$.noop).done(function(json){if(!json.length){return}
var boundingBox=json[0].boundingbox;if(!markerOptions){self.center=[boundingBox[1],boundingBox[3]];self._render()}else{self.marker=L.marker([boundingBox[1],boundingBox[3]],markerOptions).addTo(self._mapInstance);if(popup){self.marker.bindPopup(popup)}}})},_redraw:function(){var self=this;if(!self._mapInstance||self.$container.is(':hidden')){return}
$ush.timeout(self._mapInstance.invalidateSize.bind(self._mapInstance,!0),100)},_renderMarkers:function(){var self=this;if(!self.options.markers.length){return}
var mainOptions={};for(var i=0;i<self.options.markers.length;i++){var item=self.options.markers[i];if(i==0){if(self.options.icon!=_null){var mainMarkerSizes=self.options.icon.size[0],markerImg=L.icon({iconUrl:self.options.icon.url,iconSize:mainMarkerSizes,});markerImg.options.iconAnchor=[mainMarkerSizes/2,mainMarkerSizes];markerImg.options.popupAnchor=[0,-mainMarkerSizes];mainOptions.icon=markerImg}
var marker=L.marker(self.center,mainOptions).addTo(self._mapInstance);if(item.html){if(item.infowindow){marker.bindPopup(item.html).openPopup()}else{marker.bindPopup(item.html)}}}
else{var markerOptions={};if(item.marker_img!=_null){var markerSizes=item.marker_size[0],markerImg=L.icon({iconUrl:item.marker_img[0],iconSize:markerSizes,});markerImg.options.iconAnchor=[markerSizes/2,markerSizes];markerImg.options.popupAnchor=[0,-markerSizes];markerOptions.icon=markerImg}else{markerOptions=mainOptions}
var matches=$ush.removeSpaces(item.address).match(_REGEXP_EXTRACT_COORDINATES_);if(matches){self.marker=L.marker([matches[1],matches[2]],markerOptions).addTo(self._mapInstance);if(item.html){self.marker.bindPopup(item.html)}}else{self._geocoder(item.address,markerOptions,item.html)}}}}});$.fn.wLmaps=function(options){options=options||{};return this.each(function(){this._wLmaps=new $us.wLmaps(this,$ush.clone(options))})};$(function(){$('.w-map.provider_osm').wLmaps()})}(jQuery)